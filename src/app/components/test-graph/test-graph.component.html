<ng-template #connection let-to="to" let-from="from">
  <svg:g>
    <path class="connection" [attr.d]="connectionPath(from, to)" />
    <rect class="connector" [attr.x]="from.x - 4" [attr.y]="from.y - 4" width="8" height="8" />
    <rect class="connector" [attr.x]="to.x - 4" [attr.y]="to.y - 4" width="8" height="8" />
  </svg:g>
</ng-template>

<dn-graph (connectionAdded)="onConnected($event)">
  <dn-connection *ngFor="let c of connections" [from]="c.from" [to]="c.to">
    <!-- displayed at the center of the connection -->
    <span>{{c.data | percent}}</span>
  </dn-connection>
  <div *ngFor="let n of nodes; trackBy: trackNode" class="node" dnNode [(nodePos)]="n.position">
    <div class="header">{{n.name}}</div>
    <div class="ports">
      <div class="inputs">
        <div class="input">
          <a style="pointer-events: all; cursor: pointer;" (click)="addInput(n)">Add Input</a>
        </div>
        <div class="input" *ngFor="let i of n.inputs; trackBy: trackPortId">
          <div class="port" [dnInput]="portKey(n, i)" [getDragOriginPort]="getDragOriginPort" (dragStarted)="disconnectInput(portKey(n, i))" [canConnect]="$any(canConnect)" (connect)="connect($event)"></div>
          {{i.name}}
          <a style="pointer-events: all; cursor: pointer;" (click)="removeInput(n, i)">&nbsp;&#x2715;</a>
        </div>
      </div>
      <div class="divider"></div>
      <div class="outputs">
        <div class="output">
          <a style="pointer-events: all; cursor: pointer;" (click)="addOutput(n)">Add Output</a>
        </div>
        <div class="output" *ngFor="let o of n.outputs; trackBy: trackPortId">
          <a style="pointer-events: all; cursor: pointer;" (click)="removeOutput(n, o)">&#x2715;&nbsp;</a>
          {{o.name}}
          <div class="port" [dnOutput]="portKey(n, o)" [getDragOriginPort]="getDragOriginPort" (dragStarted)="disconnectOutput(portKey(n, o))" [canConnect]="$any(canConnect)" (connect)="connect($event)"></div>
        </div>
      </div>
    </div>
  </div>
</dn-graph>
